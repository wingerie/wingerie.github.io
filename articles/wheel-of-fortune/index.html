<!doctype html>

<html lang="ru">
<head>
  <meta charset="utf-8">

  <title>The HTML5 Herald</title>

  <link rel="stylesheet" href="../../css.css">
  <link href="https://fonts.googleapis.com/css?family=Rubik:400,400i,500&amp;subset=cyrillic" rel="stylesheet">

  <script src="../../js.js"></script>

</head>

<body>
    <div class="lightbox lightbox_hidden" id="lightbox">
        <button class="close_lightbox interactable" onclick="close_lightbox()">╳</button>
    </div>
    <div class="article_wrapper">
        <section>
            <h1>Управление Колесом Фортуны на Фогейме</h1>
        </section>
        <section>
            <h2>Вводные</h2>
            <p>
                Колесо Фортуны — дополнительная монетизационная механика одной из игр на платформе. Фактически это <a href="https://ru.wikipedia.org/wiki/%D0%9B%D1%83%D1%82%D0%B1%D0%BE%D0%BA%D1%81">лутбокс</a> — игрок платит за случайный предмет из призового пула. Управлением лутбокса занимаются игровые команды. Их задача — составить призовой пул, посчитать экономику, подготовить товары, шансы выпадения предметов, описания и так далее.
            </p>
            <p>
                Старый процесс работы с колесом включал в себя большое количество шагов, а так же был строг к ошибкам в процессе:
            </p>
            <img src="images/1-old-scheme.svg" class="extra_width contain">
            <ol>
                <li>Формируется список предметов</li>
                <li>
                    Заводится таблица в Google Sheets/Libra Office, которая содержит список предметов. Для каждого предмета указывается:
                    <ul>
                        <li>Название</li>
                        <li>Описание</li>
                        <li>Особенности передачи предмета внутри игры</li>
                        <li>Slug предмета из вебшопа</li>
                        <li>Количество получаемых предметов при выигрыше</li>
                        <li>Шанс 0...1</li>
                        <li>Булевый параметр, отмечающий главные призы</li>
                        <li>Булевый параметр, отмечающий предметы, требующие ручного начисления сотрудником</li>
                    </ul>
                </li>
                <li>После проверки, данные таблицы руками переносятся в специальный инструмент, написаный бэкэндерами. В инструменте так же настраиваются дополнительные параметры Колеса, такие как видимость игрокам, стоимость игры, количество оборотов и так далее.</li>
                <li>Настроенное колесо публикуется на платформе и доступно игрокам</li>
            </ol>
            <p>
                В такой системе я вижу несколько недостатков:
            </p>
            <ol>
                <li><i>Много ручного копирования</i>, как на этапе формирования списка товаров, так и при переносе во внутренний инструмент. Во-первых, это долго, во-вторых, даёт множество возможностей для ошибки.</li>
                <li><i>Дублируется функциональность другого сервиса — Вебшопа.</i> Если находятся ошибки в описании товара, то не всегда очевидно, где искать проблему — в настройках Колеса, либо в Вебшопе.</li>
                <li><i>Плохой интерфейс внутреннего инструмента:</i>
                    <ul>
                        <li>Сложно проверить правильность Колеса до публикации</li>
                        <li>Сложно найти и отредактировать данные отдельного предмета</li>
                    </ul>
                </li>
                <li><i>Для связывания призов и предметов из Вебшопа команде приходилось использовать технические slug'и</i>, которые сложнее проверить быстро.</li>
            </ol>
        </section>
        <section>
            <h2>Требования</h2>
            <p>
                Изначально задача состояла в поддержке импорта таблицы призов из Google Sheets/Libra Office и отображении таблицы в Кэрриере. Это было сделано без моего участия. Однако оказалось, что, во-первых, таблица содержит только данные о призах, но не параметры самого Колеса, и обойтись только импортом не получится. Во-вторых, в процессе работы, у продакта и разработчика появилось желание не только отобразить список призов, но и давать их редактировать из <span tooltip class="carrier">Кэрриера</span>. После этого они обратились ко мне.
            </p>
        </section>
        <section>
            <h2>Этапы работы</h2>
            <p>
                Процесс работы можно разделить на несколько этапов:
            </p>
            <ol>
                <li>Исследование текущего процесса работы игровой команды над Колесом, изучение api, поиск проблемных мест в текущем решении</li>
                <li>Формулирование нового решения, упрощение лишнего, первые макеты, тестирование на игровых командах</li>
                <li>Правки, сборка первой версии вместе с разработчиком, тестирование сборки на игровых командах</li>
                <li>Правки по результатам тестирования и дополнительные улучшения в ux вместе с разработчиком</li>
            </ol>
        </section>
        <section>
            <h2>Улучшения</h2>
            <ol>
                <li>
                    <h3>Упрощения в структуре данных</h3>
                    <p>
                        Первое, что я сделал — постарался отделить настройку Колеса от товаров:
                    </p>
                    <p>
                        Теперь Колесо лишь содержит ссылки на товары из призового пула, и управляет только сущностями Колеса — шансами получения, количеством, важностью приза и так далее.
                    </p>
                    <p>
                        Всё, что отностися к сути товара как самостоятельной сущности осталось целиком на стороне специального сервиса — Вебшопа. Оттуда подтягиваются картинки, названия и описания товаров. В будущем туда должны переехать и другие сущности, относящиеся к товару, такие как особенности передачи между игроками и ручная выдача игровой командой.
                    </p>
                    <p>
                        Технические параметры, которые мы можем генерировать автоматом больше не являются обязательными для заполнения командой — slug и ID.
                    </p>
                </li>
                <li>
                    <h3>Cтруктура страницы Колеса</h3>
                    <p>
                        Я чётко отделил три сущности на странице Колеса:
                    </p>
                    <ol>
                        <li>Шапка с метаинформацией о Колесе — название, slug, ID, видимостью игрокам</li>
                        <li>Настройки игровой составляющей — версии прокручивания, их статусы, стоимости и так далее</li>
                        <li>Список призов</li>
                    </ol>
                    <img src="images/2-wheel-screen@2x.png" class="extra_width contain interactable" onclick="lightbox_this(this)">
                </li>
                <li>
                    <h3>Облегчённое редактирование приза</h3>
                    <p>
                        Раньше, для добавления товара в Колесо, надо было найти предмет в Вебшопе и скопировать оттуда руками в таблицу в Google Sheets:
                    </p>
                    <ul>
                        <li>slug нужной версии товара</li>
                        <li>Название</li>
                        <li>Описание</li>
                    </ul>
                    <p>
                        Здесь я видел две проблемы:
                    </p>
                    <ol>
                        <li>
                            Slug, несмотря на большую человекочитаемость чем, скажем, id товара, всё равно недостаточно легко воспринимаем:
                            <ul>
                                <li>Slug может быть очень длинным, гораздо длиннее названия товара</li>
                                <li>Название конкретной версии товара докидывается в самый конец slug</li>
                                <li>Slug может использовать внутренние технические термины, которые не всегда однозначно понятны из фактического названия товара</li>
                                <li>Slug исторически придумывался руками, и содержал переводы русских слов. Не все участники игровых команд знают английский</li>
                            </ul>
                        </li>
                        <li>
                            Название и описание копируются руками из Вебшопа, что может привести к рассинхрону информации между Вебшопом и Колесом.
                        </li>
                    </ol>
                    <p>Вместо этого, мы сделали поиск по товарам в Вебшопе с садджестом и стали автоматом забирать оттуда названия и описания товаров.</p>
                    <p>Так же, раньше особенности доставки товара каждый раз нужно было писать с нуля. Я попросил игровые команды скинуть мне примеры Колёс, и нашёл в них 4 часто повторяющихся описания, которые теперь можно выбрать по-дефолту. На всякий случай есть возможность добавить кастомное описание особенностей передачи товара.</p>
                    <p>Для большей наглядности я добавил сниппет товара с пользовательской страницы колеса, чтоб команда сразу могла понять, что увидит конечный пользователь.</p>
                    <div class="two_column extra_width">
                        <img src="images/3-item-edit@2x.png" class="contain interactable" onclick="lightbox_this(this)">
                        <img src="images/4-item-edit-suggest@2x.png" class="contain interactable" onclick="lightbox_this(this)">
                    </div>
                </li>
                <li>
                    <h3>Прочие улучшения</h3>
                    <p>Так же было сделано несоклько мелких улучшений, типа изменения порядка призов драг-н-дропом, автопроверка количества товаров и суммарного шанса выпадения, можно быстрее выключить/выключить Колесо, отредактировать версии Колеса и так далее.</p>
                </li>
            </ol>
        </section>
        <section>
            <h2>Итоговый результат</h2>
            <video controls class="extra_width">
                 <source src="images/5-wheel-end.webm"
                        type="video/webm">
                Здесь должно быть .webm видео с итоговым результатом.
            </video>
        </section>
    </div>
</body>
</html>